import{c as q}from"./chunk-EGPZCQCY.js";import{b as J}from"./chunk-DQ43EHJC.js";import{a as W}from"./chunk-2JGTSTN5.js";import{a as Y,b as G}from"./chunk-4QDCXPHV.js";import{a as X}from"./chunk-YRXUO5EB.js";import{a as K}from"./chunk-7VE3XDZN.js";import{a as z}from"./chunk-YECV26LB.js";import{c as B,g as A,j as L,o as j,p as N,q as Q,r as H,w as U}from"./chunk-OML2JDMB.js";import{$a as l,Ca as d,Eb as T,Fb as k,Ia as r,Ja as o,Ka as S,Kb as V,La as v,Ma as P,Na as f,P as p,Pa as _,Q as m,Qa as g,Ta as R,Yb as F,ab as M,ac as D,bb as b,eb as C,fb as h,gb as x,ia as O,jb as E,la as s,pa as y,ta as I,ya as u}from"./chunk-KV2FSBEJ.js";var $=()=>[5,10,15,20];function ee(a,t){if(a&1&&(r(0,"option",22),l(1),o()),a&2){let e=t.$implicit;d("value",e),s(),M(e)}}function te(a,t){if(a&1){let e=f();v(0),r(1,"div",23)(2,"div",24)(3,"label"),l(4,"Fecha de Creaci\xF3n - Desde:"),o(),r(5,"input",25),x("ngModelChange",function(i){p(e);let c=g();return h(c.fechaDesde,i)||(c.fechaDesde=i),m(i)}),o()(),r(6,"div",24)(7,"label"),l(8,"Hasta:"),o(),r(9,"input",26),x("ngModelChange",function(i){p(e);let c=g();return h(c.fechaHasta,i)||(c.fechaHasta=i),m(i)}),o()()(),P()}if(a&2){let e=g();s(5),C("ngModel",e.fechaDesde),s(4),C("ngModel",e.fechaHasta)}}function ne(a,t){if(a&1){let e=f();v(0),r(1,"div",23)(2,"div",24)(3,"label"),l(4,"Fecha de Publicaci\xF3n - Desde:"),o(),r(5,"input",25),x("ngModelChange",function(i){p(e);let c=g();return h(c.fechaDesde,i)||(c.fechaDesde=i),m(i)}),o()(),r(6,"div",24)(7,"label"),l(8,"Hasta:"),o(),r(9,"input",26),x("ngModelChange",function(i){p(e);let c=g();return h(c.fechaHasta,i)||(c.fechaHasta=i),m(i)}),o()()(),P()}if(a&2){let e=g();s(5),C("ngModel",e.fechaDesde),s(4),C("ngModel",e.fechaHasta)}}function ie(a,t){if(a&1&&(r(0,"option",22),l(1),o()),a&2){let e=t.$implicit;d("value",e),s(),M(e)}}function re(a,t){if(a&1){let e=f();v(0),r(1,"select",27),x("ngModelChange",function(i){p(e);let c=g();return h(c.searchQuery,i)||(c.searchQuery=i),m(i)}),r(2,"option",28),l(3,"Seleccionar categor\xEDa..."),o(),u(4,ie,2,2,"option",3),o(),P()}if(a&2){let e=g();s(),C("ngModel",e.searchQuery),s(3),d("ngForOf",e.categorias)}}function ae(a,t){if(a&1&&(r(0,"option",22),l(1),o()),a&2){let e=t.$implicit;d("value",e),s(),M(e)}}function oe(a,t){if(a&1){let e=f();v(0),r(1,"select",27),x("ngModelChange",function(i){p(e);let c=g();return h(c.searchQuery,i)||(c.searchQuery=i),m(i)}),r(2,"option",28),l(3,"Seleccionar dificultad..."),o(),u(4,ae,2,2,"option",3),o(),P()}if(a&2){let e=g();s(),C("ngModel",e.searchQuery),s(3),d("ngForOf",e.dificultades)}}function ce(a,t){if(a&1&&(r(0,"option",34),l(1),o()),a&2){let e=t.$implicit;d("ngValue",e),s(),b(" ",e.Nombre," ")}}function se(a,t){if(a&1){let e=f();r(0,"span",37),l(1),r(2,"button",38),_("click",function(){let i=p(e).$implicit,c=g(3);return m(c.quitarIngredienteSeleccionado(i))}),l(3,"\xD7"),o()()}if(a&2){let e=t.$implicit;s(),b(" ",e.Nombre," ")}}function le(a,t){if(a&1&&(r(0,"div",35),u(1,se,4,1,"span",36),o()),a&2){let e=g(2);s(),d("ngForOf",e.ingredientesSeleccionados)}}function de(a,t){if(a&1){let e=f();v(0),r(1,"div",29)(2,"label"),l(3,"Selecciona ingredientes:"),o(),r(4,"div",30)(5,"select",31),x("ngModelChange",function(i){p(e);let c=g();return h(c.ingredientesSeleccionados,i)||(c.ingredientesSeleccionados=i),m(i)}),_("change",function(){p(e);let i=g();return m(i.onSearch())}),u(6,ce,2,2,"option",32),o()(),u(7,le,2,1,"div",33),o(),P()}if(a&2){let e=g();s(5),C("ngModel",e.ingredientesSeleccionados),s(),d("ngForOf",e.ingredientesDisponibles),s(),d("ngIf",e.ingredientesSeleccionados.length>0)}}function ge(a,t){if(a&1){let e=f();v(0),r(1,"input",39),x("ngModelChange",function(i){p(e);let c=g();return h(c.searchQuery,i)||(c.searchQuery=i),m(i)}),o(),P()}if(a&2){let e=g();s(),C("ngModel",e.searchQuery)}}function pe(a,t){a&1&&(r(0,"div",51),l(1," Mi Receta "),o())}function me(a,t){if(a&1){let e=f();r(0,"div",52),_("click",function(i){return p(e),m(i.stopPropagation())}),S(1,"app-boton-favorito",53),o()}if(a&2){let e=g().$implicit;s(),d("recetaId",e.receta_id)("mostrarTexto",!1)("tama\xF1o","medium")("variante","outlined")}}function _e(a,t){if(a&1){let e=f();r(0,"img",54),_("click",function(){p(e);let i=g().$implicit,c=g();return m(c.verDetallesReceta(i.receta_id))}),o()}if(a&2){let e=g().$implicit;R("alt","Imagen de ",e.nombre,""),d("src",e.imagen,O)}}function ue(a,t){if(a&1){let e=f();r(0,"div",40)(1,"div",41)(2,"h3"),l(3),o(),u(4,pe,2,0,"div",42)(5,me,2,4,"div",43),o(),r(6,"p",44),_("click",function(){let i=p(e).$implicit,c=g();return m(c.verDetallesReceta(i.receta_id))}),l(7),o(),u(8,_e,1,3,"img",45),r(9,"div",46),_("click",function(){let i=p(e).$implicit,c=g();return m(c.verDetallesReceta(i.receta_id))}),r(10,"span",47),S(11,"i",48),l(12),o(),r(13,"span",47),S(14,"i",49),l(15),o()(),r(16,"div",50),_("click",function(){let i=p(e).$implicit,c=g();return m(c.verDetallesReceta(i.receta_id))}),r(17,"span"),l(18,"Ver detalles"),o()()()}if(a&2){let e=t.$implicit,n=g();s(3),M(e.nombre),s(),d("ngIf",n.esRecetaPropia(e)),s(),d("ngIf",n.isLoggedIn),s(2),M(e.descripcion),s(),d("ngIf",e.imagen),s(4),b(" ",e.tiempo_total||e.tiempo_preparacion+(e.tiempo_coccion||0)," min"),s(3),b(" ",e.dificultad,"")}}function fe(a,t){a&1&&(r(0,"div",55)(1,"p"),l(2,"No hay recetas disponibles para mostrar."),o()())}var Z=class a{constructor(t,e,n,i,c){this.recetasService=t;this.cookieService=e;this.authService=n;this.router=i;this.ingredientesService=c}recetas=[];filteredRecetas=[];isLoggedIn=!1;username=null;currentUserId=null;searchQuery="";filterCriteria="nombre";fechaDesde="";fechaHasta="";categorias=Y;dificultades=G;currentPage=1;itemsPerPage=5;totalItems=0;ingredientesDisponibles=[];ingredientesSeleccionados=[];ngOnInit(){console.log("Cards-recetasComponent initialized"),setTimeout(()=>{let t=this.cookieService.get("jwt");if(!t){console.error("Error: El token no est\xE1 definido. Por favor, inicie sesi\xF3n."),this.isLoggedIn=!1,this.username=null;return}console.log("Token recuperado de las cookies:",t),this.isLoggedIn=!0,this.authService.validateToken(t).subscribe(e=>{if(e){let n=this.authService.getCurrentUser();this.username=n?.Nombre_de_usuario||null,this.currentUserId=n?.usuario_id||null,console.log("Usuario actual ID:",this.currentUserId),this.obtenerTotalRecetas()}else this.isLoggedIn=!1,this.username=null,this.currentUserId=null})},0),this.cargarIngredientes()}cargarIngredientes(){this.ingredientesService.obtenerTodosIngredientes().subscribe({next:t=>{t&&Array.isArray(t.datos)?this.ingredientesDisponibles=t.datos:Array.isArray(t)?this.ingredientesDisponibles=t:this.ingredientesDisponibles=[]},error:t=>{this.ingredientesDisponibles=[]}})}obtenerRecetas(){this.recetasService.obtenerRecetas(this.currentPage,this.itemsPerPage).subscribe(t=>{this.recetas=t.datos,this.filteredRecetas=this.recetas,this.totalItems=t.totalItems,console.log("Datos de recetas:",this.recetas),console.log("Total de elementos:",this.totalItems),console.log("Total de p\xE1ginas:",Math.ceil(this.totalItems/this.itemsPerPage)),console.log("P\xE1gina actual:",this.currentPage)},t=>{console.error("Error al obtener las recetas:",t)})}obtenerTotalRecetas(){this.recetasService.obtenerTotalRecetas().subscribe(t=>{this.totalItems=t.totalItems,console.log("Total de recetas:",this.totalItems),this.obtenerRecetas()},t=>{console.error("Error al obtener el total de recetas:",t)})}onPageChange(t){this.currentPage=t,this.realizarBusquedaConFiltros()}onItemsPerPageChange(){this.currentPage=1,this.realizarBusquedaConFiltros()}onFilterChange(){this.currentPage=1,this.filterCriteria!=="fecha_creacion"&&this.filterCriteria!=="fecha_publicacion"&&(this.fechaDesde="",this.fechaHasta=""),this.searchQuery="",this.realizarBusquedaConFiltros()}onSearch(){this.currentPage=1,this.realizarBusquedaConFiltros()}realizarBusquedaConFiltros(){let t;this.filterCriteria==="ingrediente"&&(t=this.ingredientesSeleccionados.length>0?this.ingredientesSeleccionados.map(e=>e.ingrediente_id).join(","):void 0),this.buscarRecetas(this.filterCriteria,this.filterCriteria==="ingrediente"?"":this.searchQuery,this.currentPage,this.itemsPerPage,t)}buscarRecetas(t,e,n,i,c){this.recetasService.buscarRecetasConIngredientes(t,e,n,i,c).subscribe(w=>{this.recetas=w.datos,this.filteredRecetas=this.recetas,this.totalItems=w.totalItems},w=>{console.error("Error al buscar recetas:",w)})}esRecetaPropia(t){return this.currentUserId!=null&&t.usuario_id===this.currentUserId}verDetallesReceta(t){console.log("Navegando a detalles de receta:",t),this.router.navigate(["/recetas/detalle",t])}quitarIngredienteSeleccionado(t){this.ingredientesSeleccionados=this.ingredientesSeleccionados.filter(e=>e.ingrediente_id!==t.ingrediente_id),this.onSearch()}static \u0275fac=function(e){return new(e||a)(y(K),y(z),y(W),y(F),y(X))};static \u0275cmp=I({type:a,selectors:[["app-cards-recetas"]],decls:48,vars:17,consts:[[1,"items-per-page-selector"],["for","itemsPerPage"],["id","itemsPerPage",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-bar"],[3,"ngModelChange","change","ngModel"],["value","nombre"],["value","fecha_creacion"],["value","fecha_publicacion"],["value","origen"],["value","categoria"],["value","dificultad"],["value","ingrediente"],[4,"ngIf"],[1,"search-button",3,"click"],[1,"fa","fa-search"],[1,"recetas-container"],["class","receta-item",4,"ngFor","ngForOf"],["class","no-recetas",4,"ngIf"],[1,"pagination-debug"],[1,"pagination-controls"],[3,"click","disabled"],[3,"value"],[1,"date-range-container"],[1,"date-input-group"],["type","date","placeholder","Fecha desde",3,"ngModelChange","ngModel"],["type","date","placeholder","Fecha hasta",3,"ngModelChange","ngModel"],[1,"category-select",3,"ngModelChange","ngModel"],["value",""],[1,"multi-select-ingredientes"],[1,"ingredientes-list"],["multiple","",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["class","ingredientes-seleccionados",4,"ngIf"],[3,"ngValue"],[1,"ingredientes-seleccionados"],["class","ingrediente-chip",4,"ngFor","ngForOf"],[1,"ingrediente-chip"],["type","button",3,"click"],["type","text","placeholder","Escribe para filtrar...",3,"ngModelChange","ngModel"],[1,"receta-item"],[1,"receta-header"],["class","receta-propia-badge",4,"ngIf"],["class","boton-favoritos-container",3,"click",4,"ngIf"],[1,"receta-descripcion",3,"click"],["class","receta-imagen",3,"src","alt","click",4,"ngIf"],[1,"receta-info",3,"click"],[1,"info-item"],[1,"fas","fa-clock"],[1,"fas","fa-signal"],[1,"ver-detalle-btn",3,"click"],[1,"receta-propia-badge"],[1,"boton-favoritos-container",3,"click"],[3,"recetaId","mostrarTexto","tama\xF1o","variante"],[1,"receta-imagen",3,"click","src","alt"],[1,"no-recetas"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"label",1),l(2,"Recetas por p\xE1gina:"),o(),r(3,"select",2),x("ngModelChange",function(c){return h(n.itemsPerPage,c)||(n.itemsPerPage=c),c}),_("change",function(){return n.onItemsPerPageChange()}),u(4,ee,2,2,"option",3),o()(),r(5,"div",4)(6,"select",5),x("ngModelChange",function(c){return h(n.filterCriteria,c)||(n.filterCriteria=c),c}),_("change",function(){return n.onFilterChange()}),r(7,"option",6),l(8,"Nombre"),o(),r(9,"option",7),l(10,"Fecha de Creaci\xF3n"),o(),r(11,"option",8),l(12,"Fecha de Publicaci\xF3n"),o(),r(13,"option",9),l(14,"Origen"),o(),r(15,"option",10),l(16,"Categor\xEDa"),o(),r(17,"option",11),l(18,"Dificultad"),o(),r(19,"option",12),l(20,"Ingrediente"),o()(),u(21,te,10,2,"ng-container",13)(22,ne,10,2,"ng-container",13)(23,re,5,2,"ng-container",13)(24,oe,5,2,"ng-container",13)(25,de,8,3,"ng-container",13)(26,ge,2,1,"ng-container",13),r(27,"button",14),_("click",function(){return n.onSearch()}),S(28,"i",15),l(29," Buscar "),o()(),r(30,"div",16),u(31,ue,19,7,"div",17),o(),u(32,fe,3,0,"div",18),r(33,"div",19)(34,"p")(35,"strong"),l(36,"Depuraci\xF3n de Paginaci\xF3n:"),o()(),r(37,"p"),l(38),o(),r(39,"p"),l(40),o(),r(41,"p"),l(42),o()(),r(43,"div",20)(44,"button",21),_("click",function(){return n.onPageChange(n.currentPage-1)}),l(45,"Anterior"),o(),r(46,"button",21),_("click",function(){return n.onPageChange(n.currentPage+1)}),l(47,"Siguiente"),o()()),e&2&&(s(3),C("ngModel",n.itemsPerPage),s(),d("ngForOf",E(16,$)),s(2),C("ngModel",n.filterCriteria),s(15),d("ngIf",n.filterCriteria==="fecha_creacion"),s(),d("ngIf",n.filterCriteria==="fecha_publicacion"),s(),d("ngIf",n.filterCriteria==="categoria"),s(),d("ngIf",n.filterCriteria==="dificultad"),s(),d("ngIf",n.filterCriteria==="ingrediente"),s(),d("ngIf",n.filterCriteria!=="fecha_creacion"&&n.filterCriteria!=="fecha_publicacion"&&n.filterCriteria!=="categoria"&&n.filterCriteria!=="dificultad"&&n.filterCriteria!=="ingrediente"),s(5),d("ngForOf",n.filteredRecetas),s(),d("ngIf",n.filteredRecetas.length===0),s(6),b("Total de elementos: ",n.totalItems,""),s(2),b("Elementos por p\xE1gina: ",n.itemsPerPage,""),s(2),b("P\xE1gina actual: ",n.currentPage,""),s(2),d("disabled",n.currentPage===1),s(2),d("disabled",n.currentPage*n.itemsPerPage>=n.totalItems))},dependencies:[V,T,k,D,q,U,N,H,B,j,Q,A,L,J],styles:['@charset "UTF-8";.items-per-page-selector[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}.items-per-page-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:10px}.items-per-page-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc;border-radius:4px;font-size:16px}.filter-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:20px;text-align:center}.filter-bar[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin-right:10px;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:16px}.filter-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc;border-radius:4px;font-size:16px;width:300px}.category-select[_ngcontent-%COMP%]{width:300px;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:14px;background-color:#fff}.date-range-container[_ngcontent-%COMP%]{display:flex;gap:15px;align-items:center;margin:10px 0}@media (max-width: 768px){.date-range-container[_ngcontent-%COMP%]{flex-direction:column;gap:10px}}.date-input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.date-input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:700;color:#333}.date-input-group[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc;border-radius:4px;font-size:14px}.search-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;margin-left:10px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px;transition:background-color .3s ease}.search-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}.search-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.recetas-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px;justify-content:center}.receta-item[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:15px;width:300px;box-shadow:0 2px 4px #0000001a;transition:transform .3s ease,box-shadow .3s ease;cursor:pointer;position:relative;overflow:hidden}.receta-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 16px #0003}.receta-item[_ngcontent-%COMP%]:hover   .ver-detalle-btn[_ngcontent-%COMP%]{transform:translateY(0);opacity:1}.receta-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .receta-item[_ngcontent-%COMP%]   .receta-imagen[_ngcontent-%COMP%]{width:100%;height:180px;object-fit:cover;border-radius:4px;margin-top:10px}.receta-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.receta-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;flex:1;font-weight:700;color:#333}.receta-header[_ngcontent-%COMP%]   app-boton-favorito[_ngcontent-%COMP%]{flex-shrink:0;margin-left:10px;z-index:2;position:relative}.receta-header[_ngcontent-%COMP%]   app-boton-favorito[_ngcontent-%COMP%]:hover{transform:scale(1.1);transition:transform .2s ease}.receta-descripcion[_ngcontent-%COMP%]{margin-bottom:10px;color:#666}.receta-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:10px;font-size:14px;color:#555}.receta-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.receta-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#007bff}.receta-propia-badge[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:700;box-shadow:0 2px 4px #0000001a;animation:_ngcontent-%COMP%_badge-pulse 2s infinite}.ver-detalle-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background-color:#007bffe6;color:#fff;text-align:center;padding:10px;transform:translateY(100%);opacity:0;transition:transform .3s ease,opacity .3s ease}.ver-detalle-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.card[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:8px;overflow:hidden;width:300px;box-shadow:0 4px 6px #0000001a}.card-img[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover}.card-content[_ngcontent-%COMP%]{padding:16px}.card-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px}.pagination-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:center;gap:10px}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border:1px solid #ccc;border-radius:4px;background-color:#fff;cursor:pointer;transition:background-color .3s ease}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f8f9fa}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#e9ecef;color:#6c757d;cursor:not-allowed}.pagination-debug[_ngcontent-%COMP%]{margin:20px 0;padding:10px;background-color:#f8f9fa;border-radius:4px;font-size:14px}.pagination-debug[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.no-recetas[_ngcontent-%COMP%]{text-align:center;margin-top:40px;color:#666;font-size:18px}@keyframes _ngcontent-%COMP%_badge-pulse{0%{box-shadow:0 0 #28a74566}70%{box-shadow:0 0 0 8px #28a74500}to{box-shadow:0 0 #28a74500}}']})};export{Z as CardsRecetasComponent};
