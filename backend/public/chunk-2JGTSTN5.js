import{F as r,I as c,L as p,Ob as h,e as o,f as s,j as n,k as u,s as l}from"./chunk-KV2FSBEJ.js";var d=class i{constructor(e){this.http=e}apiUrl="http://localhost:3000/api/auth";currentUserSubject=new s(null);isAuthenticatedSubject=new s(!1);userUpdatedSubject=new o;isAuthenticated$=this.isAuthenticatedSubject.asObservable();userUpdated$=this.userUpdatedSubject.asObservable();login(e){return this.http.post(`${this.apiUrl}/login`,e,{withCredentials:!0}).pipe(r(t=>{t.exito&&t.datos.usuario&&(this.currentUserSubject.next(t.datos.usuario),this.isAuthenticatedSubject.next(!0))}))}register(e){return this.http.post(`${this.apiUrl}/registrar`,e)}logout(){return this.http.post(`${this.apiUrl}/logout`,{},{withCredentials:!0}).pipe(r(()=>{this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}))}getCurrentUser(){return this.currentUserSubject.value}getUserProfile(){return this.http.get(`${this.apiUrl}/usuario`,{withCredentials:!0})}validateToken(e){return console.log("AAAAAAValidando token :",e),this.http.post(`${this.apiUrl}/validar-token`,{token:e},{withCredentials:!0}).pipe(r(t=>{t.exito&&t.datos.usuario?(this.currentUserSubject.next(t.datos.usuario),this.isAuthenticatedSubject.next(!0),console.log("Token validado correctamente:",t.datos.usuario)):(this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1))}),u(t=>t.exito))}updateUserProfile(e){return this.http.put(`${this.apiUrl}/actualizarusuario`,e,{withCredentials:!0}).pipe(r(t=>{if(t?.exito){let a=t?.datos?.usuario||e;this.currentUserSubject.next(a),this.userUpdatedSubject.next(a)}else console.error("Error: La respuesta no contiene los datos esperados.",t)}),l(t=>(console.error("Error en la solicitud de actualizaci\xF3n:",t),n(()=>t))))}updateCurrentUser(e){this.currentUserSubject.next(e)}static \u0275fac=function(t){return new(t||i)(p(h))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{d as a};
