import{a as v}from"./chunk-2JGTSTN5.js";import{a as J}from"./chunk-YECV26LB.js";import{$a as a,$b as $,C as E,Ca as A,Ea as I,Ha as O,Ia as o,Ja as r,Ka as y,Kb as F,M as w,Mb as Z,Na as T,P as m,Pa as d,Pb as U,Q as g,Qa as u,Qb as G,Rb as V,Sb as B,Ub as Y,Vb as K,Xb as q,Yb as f,Zb as W,_b as X,bb as j,i as _,ia as H,jb as z,k as L,ka as R,la as l,pa as M,s as D,sb as N,ta as P,ya as h}from"./chunk-KV2FSBEJ.js";var c=(e,t)=>{let n=w(v),i=w(f);return n.isAuthenticated$.pipe(E(s=>{if(s)return console.log("Usuario autenticado. Acceso permitido."),_(!0);if(typeof document<"u"){let S=document.cookie.split("; ").find(p=>p.startsWith("jwt=")),x=S?S.split("=")[1]:null;if(x&&x.trim()!=="")return console.log("Token encontrado en cookies. Validando token..."),n.validateToken(x).pipe(L(p=>p?(console.log("Token v\xE1lido. Acceso permitido."),!0):(console.warn("Token inv\xE1lido o expirado. Redirigiendo al login."),i.navigate(["/login"],{queryParams:{returnUrl:t.url}}),!1)),D(p=>(console.error("Error al validar el token:",p),i.navigate(["/login"],{queryParams:{returnUrl:t.url}}),_(!1))));console.warn("No se encontr\xF3 un token en las cookies. Redirigiendo al login.")}else console.error("Entorno no compatible para verificar cookies.");return i.navigate(["/login"],{queryParams:{returnUrl:t.url}}),_(!1)}))};var Q=[{path:"",loadComponent:()=>import("./chunk-FPZFYCHL.js").then(e=>e.HomeComponent),canActivate:[c]},{path:"login",loadComponent:()=>import("./chunk-R3JCPNCM.js").then(e=>e.LoginComponent)},{path:"registro",loadComponent:()=>import("./chunk-C3PPSPOU.js").then(e=>e.RegisterComponent)},{path:"home",loadComponent:()=>import("./chunk-FPZFYCHL.js").then(e=>e.HomeComponent),canActivate:[c]},{path:"perfil",loadComponent:()=>import("./chunk-2NBD6DYJ.js").then(e=>e.ProfileComponent),canActivate:[c]},{path:"usuario/perfil/:id",loadComponent:()=>import("./chunk-2NBD6DYJ.js").then(e=>e.ProfileComponent),canActivate:[c],data:{prerender:!1}},{path:"explorar",loadComponent:()=>import("./chunk-HHQIVHLL.js").then(e=>e.CardsRecetasComponent),canActivate:[c]},{path:"crear-receta",loadComponent:()=>import("./chunk-72Z527WS.js").then(e=>e.CrearRecetasComponent),canActivate:[c]},{path:"mis-recetas",loadComponent:()=>import("./chunk-G6DZFYIW.js").then(e=>e.RecetasPersonalesComponent),canActivate:[c]},{path:"recetas/detalle/:id",loadComponent:()=>import("./chunk-4BT5O3HT.js").then(e=>e.DetalleRecetasComponent),canActivate:[c],data:{prerender:!1}},{path:"modificar-receta/:id",loadComponent:()=>import("./chunk-EBCHLCKF.js").then(e=>e.ModificarRecetasComponent),canActivate:[c]},{path:"crear-paso/:receta_id",loadComponent:()=>import("./chunk-EWBSW7YY.js").then(e=>e.CrearPasosComponent),canActivate:[c],data:{prerender:!1}},{path:"buscar-usuarios",loadComponent:()=>import("./chunk-KMIUTQEM.js").then(e=>e.BuscarUsuariosComponent),canActivate:[c]},{path:"usuario/detalle/:id",loadComponent:()=>import("./chunk-ZCPOHAGO.js").then(e=>e.DetalleUsuariosComponent),canActivate:[c],data:{prerender:!1}},{path:"favoritos",loadComponent:()=>import("./chunk-E353SCWI.js").then(e=>e.FavoritosComponent),canActivate:[c]},{path:"**",redirectTo:""}];var ee={providers:[N({eventCoalescing:!0}),$(Q),K(Y()),U(G(),V())]};var oe=()=>({exact:!0});function re(e,t){e&1&&(o(0,"li")(1,"a",12),a(2,"Mis Recetas"),r()(),o(3,"li")(4,"a",13),a(5,"Crear Receta"),r()(),o(6,"li")(7,"a",14),a(8,"Buscar Usuarios"),r()())}function ie(e,t){e&1&&(o(0,"span"),a(1,"\u2600\uFE0F"),r())}function ae(e,t){e&1&&(o(0,"span"),a(1,"\u{1F319}"),r())}function ce(e,t){if(e&1){let n=T();o(0,"div",15)(1,"span",16),d("click",function(){m(n);let s=u();return g(s.toggleMenu())}),a(2),o(3,"div",17)(4,"img",18),d("error",function(s){m(n);let C=u();return g(C.onImageError(s))}),r()()(),o(5,"div",19)(6,"a",20),d("click",function(){m(n);let s=u();return g(s.closeMenu())}),a(7,"Mi Perfil"),r(),o(8,"a",21),d("click",function(){m(n);let s=u();return g(s.closeMenu())}),a(9,"Mis Favoritos"),r(),o(10,"button",22),d("click",function(){m(n);let s=u();return g(s.logout())}),a(11,"Cerrar Sesi\xF3n"),r()()()}if(e&2){let n=u();I("menu-open",n.isMenuOpen),l(2),j(" Hola, ",n.username," "),l(2),A("src",n.fotoPerfil||n.defaultAvatar,H)("alt",n.username+" avatar"),l(),I("open",n.isMenuOpen)}}function se(e,t){e&1&&(o(0,"div",11)(1,"a",23),a(2,"Iniciar Sesi\xF3n"),r(),o(3,"a",24),a(4,"Registrarse"),r()())}var k=class e{constructor(t,n,i){this.authService=t;this.cookieService=n;this.router=i}isLoggedIn=!1;username=null;fotoPerfil=null;isDarkMode=!1;isMenuOpen=!1;defaultAvatar="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNlNzRjM2MiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxMiIgcj0iNCIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPHBhdGggZD0iTTggMjVjMC00LjQgMy42LTggOC04czggMy42IDggOCIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPC9zdmc+Cg==";ngOnInit(){console.log("HeaderComponent initialized"),this.authService.isAuthenticated$.subscribe(n=>{this.isLoggedIn=n,n?this.loadUserProfile():(this.username=null,this.fotoPerfil=null)});let t=this.cookieService.get("jwt");console.log("Token recuperado de las cookies antes de confirmar:",t),t&&t.trim()!==""?(console.log("Token recuperado de las cookies despues de confirmar:",t),this.authService.validateToken(t).subscribe({next:n=>{n?this.loadUserProfile():(this.isLoggedIn=!1,this.username=null,this.fotoPerfil=null)},error:n=>{console.error("Error al validar el token:",n),this.isLoggedIn=!1,this.username=null,this.fotoPerfil=null}})):(console.log("No se encontr\xF3 un token v\xE1lido en las cookies."),this.isLoggedIn=!1,this.username=null,this.fotoPerfil=null)}loadUserProfile(){this.authService.getUserProfile().subscribe({next:t=>{if(t?.exito&&t?.datos){let n=t.datos;this.username=n.Nombre_de_usuario,this.fotoPerfil=n.Foto_de_perfil||this.defaultAvatar,this.authService.updateCurrentUser({usuario_id:n.usuario_id,Nombre_de_usuario:n.Nombre_de_usuario,Rol:n.Rol,Foto_de_perfil:n.Foto_de_perfil})}},error:t=>{console.error("Error al cargar el perfil del usuario:",t);let n=this.authService.getCurrentUser();n&&(this.username=n.Nombre_de_usuario,this.fotoPerfil=n.Foto_de_perfil||this.defaultAvatar)}})}logout(){this.authService.logout().subscribe({next:()=>{this.router.navigate(["/login"])},error:t=>{console.error("Error during logout:",t)}})}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,document.body.classList.toggle("dark-theme",this.isDarkMode)}toggleMenu(){this.isMenuOpen=!this.isMenuOpen}closeMenu(){this.isMenuOpen=!1}onImageError(t){console.log("Error al cargar la imagen de perfil, usando avatar por defecto"),t.target.src=this.defaultAvatar,this.fotoPerfil=this.defaultAvatar}onDocumentClick(t){!t.target.closest(".user-menu")&&this.isMenuOpen&&(this.isMenuOpen=!1)}static \u0275fac=function(n){return new(n||e)(M(v),M(J),M(f))};static \u0275cmp=P({type:e,selectors:[["app-header"]],hostBindings:function(n,i){n&1&&d("click",function(C){return i.onDocumentClick(C)},!1,R)},decls:22,vars:5,consts:[[1,"header"],[1,"container"],[1,"header-content"],[1,"logo"],["routerLink","/"],[1,"main-nav"],["routerLink","/","routerLinkActive","active",3,"routerLinkActiveOptions"],["routerLink","/explorar","routerLinkActive","active"],[1,"user-actions"],[1,"theme-toggle",3,"click"],[1,"user-menu",3,"menu-open"],[1,"auth-buttons"],["routerLink","/mis-recetas","routerLinkActive","active"],["routerLink","/crear-receta","routerLinkActive","active"],["routerLink","/buscar-usuarios","routerLinkActive","active"],[1,"user-menu"],[1,"username",3,"click"],[1,"user-avatar"],[1,"avatar-image",3,"error","src","alt"],[1,"dropdown-menu"],["routerLink","/perfil",3,"click"],["routerLink","/favoritos",3,"click"],[3,"click"],["routerLink","/login",1,"btn","btn-login"],["routerLink","/registro",1,"btn","btn-register"]],template:function(n,i){n&1&&(o(0,"header",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4)(5,"h1"),a(6,"Recetario"),r()()(),o(7,"nav",5)(8,"ul")(9,"li")(10,"a",6),a(11,"Inicio"),r()(),h(12,re,9,0),o(13,"li")(14,"a",7),a(15,"Explorar"),r()()()(),o(16,"div",8)(17,"button",9),d("click",function(){return i.toggleDarkMode()}),h(18,ie,2,0,"span")(19,ae,2,0,"span"),r(),h(20,ce,12,7,"div",10)(21,se,5,0,"div",11),r()()()()),n&2&&(l(10),A("routerLinkActiveOptions",z(4,oe)),l(2),O(i.isLoggedIn?12:-1),l(6),O(i.isDarkMode?18:19),l(2),O(i.isLoggedIn?20:21))},dependencies:[F,W,X],styles:['.header[_ngcontent-%COMP%]{background-color:#fff;box-shadow:0 2px 10px #0000001a;position:sticky;top:0;z-index:100;padding:1rem 0}.header[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#e74c3c}.header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;margin:0;font-weight:700}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:flex;list-style:none;margin:0;padding:0}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0 1rem}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#333;font-weight:500;padding:.5rem 0;position:relative;transition:color .3s}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#e74c3c}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover:after, .header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:after{width:100%}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-2px;left:0;width:0;height:2px;background-color:#e74c3c;transition:width .3s}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .theme-toggle[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.2rem;padding:.3rem;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .3s}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .theme-toggle[_ngcontent-%COMP%]:hover{background-color:#0000000d}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-weight:500;cursor:pointer;padding:.5rem;border-radius:4px;-webkit-user-select:none;user-select:none;display:flex;align-items:center;gap:.5rem}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]:hover{background-color:#0000000d}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   .avatar-image[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;border:2px solid #e74c3c;transition:transform .3s ease}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu.menu-open[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   .avatar-image[_ngcontent-%COMP%]{transform:scale(1.1)}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background-color:#fff;box-shadow:0 2px 10px #0000001a;border-radius:4px;min-width:180px;display:none;padding:.5rem 0;margin-top:.5rem;z-index:1000;opacity:0;transform:translateY(-10px);transition:opacity .3s ease,transform .3s ease}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu.open[_ngcontent-%COMP%]{display:block;opacity:1;transform:translateY(0)}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block;padding:.5rem 1rem;text-decoration:none;color:#333;text-align:left;width:100%;background:none;border:none;cursor:pointer;font-size:.9rem}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0000000d;color:#e74c3c}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .auth-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .auth-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:4px;text-decoration:none;font-weight:500;transition:all .3s}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .auth-buttons[_ngcontent-%COMP%]   .btn.btn-login[_ngcontent-%COMP%]{color:#e74c3c;border:1px solid #e74c3c}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .auth-buttons[_ngcontent-%COMP%]   .btn.btn-login[_ngcontent-%COMP%]:hover{background-color:#e74c3c1a}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .auth-buttons[_ngcontent-%COMP%]   .btn.btn-register[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .auth-buttons[_ngcontent-%COMP%]   .btn.btn-register[_ngcontent-%COMP%]:hover{background-color:#c0392b}@media (max-width: 768px){.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}.header[_ngcontent-%COMP%]   .main-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.5rem}.header[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{width:100%;justify-content:center}}.dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]:hover, .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]:hover{background-color:#ffffff1a}.dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   .avatar-image[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   .avatar-image[_ngcontent-%COMP%]{border-color:#ff6b5a;box-shadow:0 0 0 2px #ff6b5a4d}.dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{background-color:#2c3e50;box-shadow:0 2px 10px #0000004d}.dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#ecf0f1}.dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .dark-theme[_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .dark-theme   [_nghost-%COMP%]   .user-menu[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ffffff1a;color:#ff6b5a}']})};var b=class e{title="Recetario";static \u0275fac=function(n){return new(n||e)};static \u0275cmp=P({type:e,selectors:[["app-root"]],decls:3,vars:0,template:function(n,i){n&1&&(y(0,"app-header"),o(1,"main"),y(2,"router-outlet"),r())},dependencies:[q,k,B],styles:["main[_ngcontent-%COMP%]{min-height:calc(100vh - 80px)}"]})};Z(b,ee).catch(e=>console.error(e));
