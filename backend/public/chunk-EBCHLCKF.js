import{a as ie}from"./chunk-ZXUOHQ5V.js";import{a as k}from"./chunk-2JGTSTN5.js";import{a as ee}from"./chunk-YRXUO5EB.js";import{a as $}from"./chunk-7VE3XDZN.js";import"./chunk-YECV26LB.js";import{b as D,c as F,g as G,h as z,i as B,j as H,k as j,l as U,o as X,p as q,r as K,s as Y,t as J,u as Q,w as Z}from"./chunk-OML2JDMB.js";import{$a as l,Ca as p,Db as O,Eb as T,Fb as V,Ia as o,Ja as n,Ka as E,Kb as L,Na as b,P as m,Pa as C,Q as g,Qa as s,Ta as y,Tb as N,Wb as A,Yb as W,_a as R,ab as x,bb as M,eb as u,fb as v,gb as f,ia as S,ja as P,la as c,lb as w,pa as h,ta as I,ya as _}from"./chunk-KV2FSBEJ.js";var te=(r,t)=>({"texto-verde":r,"texto-rojo":t});function oe(r,t){r&1&&(o(0,"div",5)(1,"p"),l(2,"Cargando informaci\xF3n de la receta..."),n()())}function re(r,t){if(r&1){let e=b();o(0,"div",6)(1,"p"),l(2),n(),o(3,"button",7),C("click",function(){m(e);let i=s();return g(i.cancelar())}),l(4,"Volver"),n()()}if(r&2){let e=s();c(2),x(e.error)}}function ae(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.nombre)}}function ce(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.imagen)}}function de(r,t){if(r&1&&(o(0,"div",60),E(1,"img",61),o(2,"span",62),l(3,"Vista previa"),n()()),r&2){let e=s(3);c(),p("src",e.imagePreview,S)}}function le(r,t){r&1&&(o(0,"div",63)(1,"span",64),l(2,"\u26A0\uFE0F"),n(),o(3,"span",65),l(4,"No se pudo cargar la imagen"),n()())}function se(r,t){if(r&1&&(o(0,"div",57),_(1,de,4,1,"div",58)(2,le,5,0,"div",59),n()),r&2){let e=s(2);c(),p("ngIf",e.imagePreview&&!e.imageError),c(),p("ngIf",e.imageError)}}function pe(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.videoLink)}}function me(r,t){if(r&1&&(o(0,"div",69),E(1,"iframe",70),o(2,"p",62),l(3,"Vista previa del video"),n()()),r&2){let e=s(3);c(),p("src",e.videoPreview,P)}}function ge(r,t){r&1&&(o(0,"div",71)(1,"i",64),l(2,"\u26A0\uFE0F"),n(),o(3,"p"),l(4,"No se pudo cargar el video. Verifica que sea una URL v\xE1lida de YouTube."),n()())}function _e(r,t){if(r&1&&(o(0,"div",66),_(1,me,4,1,"div",67)(2,ge,5,0,"div",68),n()),r&2){let e=s(2);c(),p("ngIf",e.videoPreview&&!e.videoError),c(),p("ngIf",e.videoError)}}function ue(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.descripcion)}}function ve(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.origen)}}function fe(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(3);c(),x(e.formErrors.autorOriginal)}}function xe(r,t){if(r&1){let e=b();o(0,"div")(1,"label",72),l(2,"Nombre del autor original:"),n(),o(3,"input",73),f("ngModelChange",function(i){m(e);let a=s(2);return v(a.autorOriginal,i)||(a.autorOriginal=i),g(i)}),n(),_(4,fe,2,1,"div",3),n()}if(r&2){let e=s(2);c(3),u("ngModel",e.autorOriginal),c(),p("ngIf",e.formErrors.autorOriginal)}}function he(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.tiempo_preparacion)}}function Ce(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.tiempo_coccion)}}function Me(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.tiempo_total)}}function be(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.porciones)}}function Ee(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.calorias_totales)}}function ye(r,t){if(r&1&&(o(0,"option",74),l(1),n()),r&2){let e=t.$implicit;p("value",e.ingrediente_id),c(),M(" ",e.Nombre," ")}}function we(r,t){if(r&1&&(o(0,"div",6),l(1),n()),r&2){let e=s(2);c(),x(e.formErrors.ingredientes)}}function Se(r,t){if(r&1&&(o(0,"option",74),l(1),n()),r&2){let e=t.$implicit;p("value",e.valor),c(),x(e.texto)}}function Pe(r,t){if(r&1&&(o(0,"optgroup",80),_(1,Se,2,2,"option",52),n()),r&2){let e=t.$implicit;p("label",e.nombre),c(),p("ngForOf",e.unidades)}}function Ie(r,t){if(r&1){let e=b();o(0,"li"),l(1),o(2,"input",76),f("ngModelChange",function(i){let a=m(e).$implicit;return v(a.cantidad,i)||(a.cantidad=i),g(i)}),n(),o(3,"select",77),f("ngModelChange",function(i){let a=m(e).$implicit;return v(a.unidad,i)||(a.unidad=i),g(i)}),o(4,"option",51),l(5,"Selecciona unidad"),n(),_(6,Pe,2,2,"optgroup",78),n(),o(7,"button",79),C("click",function(){let i=m(e).index,a=s(3);return g(a.eliminarIngrediente(i))}),l(8,"Eliminar"),n()()}if(r&2){let e=t.$implicit,d=t.index,i=s(3);c(),M(" ",e.Nombre," "),c(),y("name","cantidad",d,""),u("ngModel",e.cantidad),c(),y("name","unidad",d,""),u("ngModel",e.unidad),c(3),p("ngForOf",i.unidadesMedidaGrupos)}}function Re(r,t){if(r&1&&(o(0,"div")(1,"h3"),l(2,"Ingredientes seleccionados:"),n(),o(3,"ul"),_(4,Ie,9,8,"li",75),n()()),r&2){let e=s(2);c(4),p("ngForOf",e.ingredientesSeleccionados)}}function Oe(r,t){if(r&1&&(o(0,"div",81),l(1),n()),r&2){let e=s(2);c(),M(" ",e.formErrors.general," ")}}function Te(r,t){if(r&1){let e=b();o(0,"div")(1,"h2"),l(2,"Modificar Receta"),n(),o(3,"form",8,0),C("ngSubmit",function(){m(e);let i=R(4),a=s();return g(a.onSubmit(i))}),o(5,"div")(6,"label",9),l(7,"Nombre:"),n(),o(8,"input",10),f("ngModelChange",function(i){m(e);let a=s();return v(a.nombre,i)||(a.nombre=i),g(i)}),n(),_(9,ae,2,1,"div",3),n(),o(10,"div")(11,"label",11),l(12,"Imagen (URL):"),n(),o(13,"input",12),f("ngModelChange",function(i){m(e);let a=s();return v(a.imagen,i)||(a.imagen=i),g(i)}),C("input",function(){m(e);let i=s();return g(i.updateImagePreview(i.imagen))}),n(),_(14,ce,2,1,"div",3)(15,se,3,2,"div",13),n(),o(16,"div")(17,"label",14),l(18,"Enlace del v\xEDdeo:"),n(),o(19,"input",15),f("ngModelChange",function(i){m(e);let a=s();return v(a.videoLink,i)||(a.videoLink=i),g(i)}),C("input",function(i){m(e);let a=s();return g(a.updateVideoPreview(i))}),n(),_(20,pe,2,1,"div",3)(21,_e,3,2,"div",16),n(),o(22,"div")(23,"label",17),l(24,"Descripci\xF3n:"),n(),o(25,"textarea",18),f("ngModelChange",function(i){m(e);let a=s();return v(a.descripcion,i)||(a.descripcion=i),g(i)}),n(),_(26,ue,2,1,"div",3),n(),o(27,"div")(28,"label",19),l(29,"Origen de la receta:"),n(),o(30,"input",20),f("ngModelChange",function(i){m(e);let a=s();return v(a.origen,i)||(a.origen=i),g(i)}),n(),_(31,ve,2,1,"div",3),n(),o(32,"div")(33,"label",21),l(34,"Fecha de creaci\xF3n:"),n(),o(35,"input",22),f("ngModelChange",function(i){m(e);let a=s();return v(a.fechaCreacion,i)||(a.fechaCreacion=i),g(i)}),n()(),o(36,"div")(37,"label",23),l(38,"Visibilidad:"),n(),o(39,"input",24),f("ngModelChange",function(i){m(e);let a=s();return v(a.esPublica,i)||(a.esPublica=i),g(i)}),n(),o(40,"span",25),l(41),n()(),o(42,"div")(43,"label",26),l(44,"\xBFEs creaci\xF3n propia?"),n(),o(45,"input",27),f("ngModelChange",function(i){m(e);let a=s();return v(a.esCreacionPropia,i)||(a.esCreacionPropia=i),g(i)}),n(),o(46,"span",25),l(47),n()(),_(48,xe,5,2,"div",4),o(49,"div")(50,"label",28),l(51,"Tiempo de preparaci\xF3n (minutos):"),n(),o(52,"input",29),f("ngModelChange",function(i){m(e);let a=s();return v(a.tiempo_preparacion,i)||(a.tiempo_preparacion=i),g(i)}),n(),_(53,he,2,1,"div",3),n(),o(54,"div")(55,"label",30),l(56,"Tiempo de cocci\xF3n (minutos):"),n(),o(57,"input",31),f("ngModelChange",function(i){m(e);let a=s();return v(a.tiempo_coccion,i)||(a.tiempo_coccion=i),g(i)}),n(),_(58,Ce,2,1,"div",3),n(),o(59,"div")(60,"label",32),l(61,"Tiempo total (minutos):"),n(),o(62,"input",33),f("ngModelChange",function(i){m(e);let a=s();return v(a.tiempo_total,i)||(a.tiempo_total=i),g(i)}),n(),_(63,Me,2,1,"div",3),n(),o(64,"div")(65,"label",34),l(66,"Categor\xEDa:"),n(),o(67,"select",35),f("ngModelChange",function(i){m(e);let a=s();return v(a.categoria,i)||(a.categoria=i),g(i)}),o(68,"option",36),l(69,"Postre"),n(),o(70,"option",37),l(71,"Plato principal"),n(),o(72,"option",38),l(73,"Entrada"),n(),o(74,"option",39),l(75,"Bebida"),n()()(),o(76,"div")(77,"label",40),l(78,"Porciones:"),n(),o(79,"input",41),f("ngModelChange",function(i){m(e);let a=s();return v(a.porciones,i)||(a.porciones=i),g(i)}),n(),_(80,be,2,1,"div",3),n(),o(81,"div")(82,"label",42),l(83,"Calor\xEDas totales:"),n(),o(84,"input",43),f("ngModelChange",function(i){m(e);let a=s();return v(a.calorias_totales,i)||(a.calorias_totales=i),g(i)}),n(),_(85,Ee,2,1,"div",3),n(),o(86,"div")(87,"label",44),l(88,"Dificultad:"),n(),o(89,"select",45),f("ngModelChange",function(i){m(e);let a=s();return v(a.dificultad,i)||(a.dificultad=i),g(i)}),o(90,"option",46),l(91,"F\xE1cil"),n(),o(92,"option",47),l(93,"Media"),n(),o(94,"option",48),l(95,"Dif\xEDcil"),n()()(),o(96,"div")(97,"label",49),l(98,"Ingredientes:"),n(),o(99,"select",50),C("change",function(i){m(e);let a=s();return g(a.agregarIngrediente(i))}),o(100,"option",51),l(101,"Selecciona un ingrediente"),n(),_(102,ye,2,2,"option",52),n(),_(103,we,2,1,"div",3),n(),_(104,Re,5,1,"div",4)(105,Oe,2,1,"div",53),o(106,"div",54)(107,"button",55),l(108,"Guardar cambios"),n(),o(109,"button",56),C("click",function(){m(e);let i=s();return g(i.cancelar())}),l(110,"Cancelar"),n()()()()}if(r&2){let e=s();c(8),u("ngModel",e.nombre),c(),p("ngIf",e.formErrors.nombre),c(4),u("ngModel",e.imagen),c(),p("ngIf",e.formErrors.imagen),c(),p("ngIf",e.imagePreview||e.imageError),c(4),u("ngModel",e.videoLink),c(),p("ngIf",e.formErrors.videoLink),c(),p("ngIf",e.videoPreview||e.videoError),c(4),u("ngModel",e.descripcion),c(),p("ngIf",e.formErrors.descripcion),c(4),u("ngModel",e.origen),c(),p("ngIf",e.formErrors.origen),c(4),u("ngModel",e.fechaCreacion),c(4),u("ngModel",e.esPublica),c(),p("ngClass",w(36,te,e.esPublica,!e.esPublica)),c(),M(" ",e.esPublica?"P\xFAblica":"Privada"," "),c(4),u("ngModel",e.esCreacionPropia),c(),p("ngClass",w(39,te,e.esCreacionPropia,!e.esCreacionPropia)),c(),M(" ",e.esCreacionPropia?"Propia":"Indica el propietario"," "),c(),p("ngIf",!e.esCreacionPropia),c(4),u("ngModel",e.tiempo_preparacion),c(),p("ngIf",e.formErrors.tiempo_preparacion),c(4),u("ngModel",e.tiempo_coccion),c(),p("ngIf",e.formErrors.tiempo_coccion),c(4),u("ngModel",e.tiempo_total),c(),p("ngIf",e.formErrors.tiempo_total),c(4),u("ngModel",e.categoria),c(12),u("ngModel",e.porciones),c(),p("ngIf",e.formErrors.porciones),c(4),u("ngModel",e.calorias_totales),c(),p("ngIf",e.formErrors.calorias_totales),c(4),u("ngModel",e.dificultad),c(13),p("ngForOf",e.ingredientesDisponibles),c(),p("ngIf",e.formErrors.ingredientes),c(),p("ngIf",e.ingredientesSeleccionados.length>0),c(),p("ngIf",e.formErrors.general)}}var ne=class r{constructor(t,e,d,i,a,Ve,Le){this.route=t;this.router=e;this.recetasService=d;this.ingredientesService=i;this.recetaIngredientesService=a;this.authService=Ve;this.sanitizer=Le}recetaId=0;receta={};ingredientesDisponibles=[];ingredientesSeleccionados=[];cargando=!0;error=null;esPropietario=!1;usuarioActualId=null;nombre="";imagen="";videoLink="";descripcion="";origen="";fechaCreacion="";esPublica=!0;esCreacionPropia=!0;autorOriginal="";tiempo_preparacion=0;tiempo_coccion=0;tiempo_total=0;categoria="";porciones=0;calorias_totales=0;dificultad="";formErrors={};NOMBRE_MAX_LENGTH=255;IMAGEN_MAX_LENGTH=2048;DESCRIPCION_MAX_LENGTH=255;ORIGEN_MAX_LENGTH=255;VIDEO_MAX_LENGTH=255;AUTOR_MAX_LENGTH=255;DIFICULTAD_MAX_LENGTH=255;CATEGORIA_MAX_LENGTH=255;unidadesMedidaGrupos=[{nombre:"Peso",unidades:[{valor:"Gramo (g)",texto:"Gramo (g)"},{valor:"Kilogramo (kg)",texto:"Kilogramo (kg)"},{valor:"Miligramo (mg)",texto:"Miligramo (mg)"},{valor:"Libra (lb)",texto:"Libra (lb)"},{valor:"Onza (oz)",texto:"Onza (oz)"}]},{nombre:"Volumen",unidades:[{valor:"Mililitro (ml)",texto:"Mililitro (ml)"},{valor:"Centilitro (cl)",texto:"Centilitro (cl)"},{valor:"Litro (l)",texto:"Litro (l)"},{valor:"Cent\xEDmetro c\xFAbico (cc)",texto:"Cent\xEDmetro c\xFAbico (cc)"},{valor:"Taza",texto:"Taza"},{valor:"Cucharada",texto:"Cucharada"},{valor:"Cucharadita",texto:"Cucharadita"}]},{nombre:"Unidades",unidades:[{valor:"Unidad",texto:"Unidad"},{valor:"Pieza",texto:"Pieza"},{valor:"Rodaja",texto:"Rodaja"},{valor:"Rebanada",texto:"Rebanada"},{valor:"Trozo",texto:"Trozo"}]},{nombre:"Otros",unidades:[{valor:"Pizca",texto:"Pizca"},{valor:"Al gusto",texto:"Al gusto"},{valor:"Manojo",texto:"Manojo"},{valor:"Pu\xF1ado",texto:"Pu\xF1ado"}]}];imagePreview=null;imageError=!1;videoPreview=null;videoError=!1;ngOnInit(){let t=this.authService.getCurrentUser();if(this.usuarioActualId=t?.usuario_id||null,!this.usuarioActualId){this.error="Necesitas iniciar sesi\xF3n para modificar recetas",this.cargando=!1;return}this.route.params.subscribe(e=>{this.recetaId=+e.id,this.recetaId?(this.cargarIngredientesDisponibles(),this.cargarReceta()):(this.error="ID de receta no v\xE1lido",this.cargando=!1)})}cargarIngredientesDisponibles(){this.ingredientesService.obtenerTodosIngredientes().subscribe({next:t=>{this.ingredientesDisponibles=t.datos,console.log("Ingredientes disponibles:",this.ingredientesDisponibles)},error:t=>{console.error("Error al cargar los ingredientes:",t)}})}cargarReceta(){this.cargando=!0,this.error=null,this.recetasService.obtenerRecetaPorId(this.recetaId).subscribe({next:t=>{if(t&&t.datos){if(this.receta=t.datos,console.log("Receta cargada:",this.receta),this.esPropietario=this.usuarioActualId!==null&&this.receta.usuario_id===this.usuarioActualId,!this.esPropietario){this.error="No tienes permiso para modificar esta receta",this.cargando=!1;return}this.nombre=this.receta.nombre||"",this.imagen=this.receta.imagen||"",this.videoLink=this.receta.video_instrucciones||"",this.descripcion=this.receta.descripcion||"",this.origen=this.receta.origen||"",this.fechaCreacion=this.receta.fecha_creacion?this.formatDate(this.receta.fecha_creacion):"",this.esPublica=this.receta.publica===1||this.receta.publica===!0,this.autorOriginal=this.receta.autor||"",this.esCreacionPropia=!this.autorOriginal,console.log("Estado checkbox esPublica:",this.receta.publica,"->",this.esPublica),console.log("Autor original:",this.autorOriginal),console.log("Estado checkbox esCreacionPropia:",!this.autorOriginal,"->",this.esCreacionPropia),this.tiempo_preparacion=this.receta.tiempo_preparacion||0,this.tiempo_coccion=this.receta.tiempo_coccion||0,this.tiempo_total=this.receta.tiempo_total||0,this.categoria=this.receta.categoria||"",this.porciones=this.receta.porciones||0,this.calorias_totales=this.receta.calorias_totales||0,this.dificultad=this.receta.dificultad||"",this.cargarIngredientesReceta(),this.updateImagePreview(this.imagen),this.cargando=!1}else this.error="No se encontr\xF3 la receta",this.cargando=!1},error:t=>{console.error("Error al cargar la receta:",t),this.error="Error al cargar la receta. Por favor, int\xE9ntalo de nuevo.",this.cargando=!1}})}cargarIngredientesReceta(){this.recetaIngredientesService.getIngredientesByReceta(this.recetaId).subscribe({next:t=>{let e=[];t&&typeof t=="object"&&(!Array.isArray(t)&&"datos"in t?e=Array.isArray(t.datos)?t.datos:[]:Array.isArray(t)&&(e=t)),this.ingredientesSeleccionados=e.map(d=>{let i=this.ingredientesDisponibles.find(a=>a.ingrediente_id===d.ingrediente_id);return{ingrediente_id:d.ingrediente_id,Nombre:i?i.Nombre:"Desconocido",cantidad:d.Cantidad||"",unidad:d.Unidad||""}}),console.log("Ingredientes de la receta cargados:",this.ingredientesSeleccionados)},error:t=>{console.error("Error al cargar los ingredientes de la receta:",t)}})}formatDate(t){return new Date(t).toISOString().split("T")[0]}agregarIngrediente(t){let e=t.target,d=parseInt(e.value,10);if(d){let i=this.ingredientesDisponibles.find(a=>a.ingrediente_id===d);i&&!this.ingredientesSeleccionados.some(a=>a.ingrediente_id===i.ingrediente_id)&&(this.ingredientesSeleccionados.push({ingrediente_id:i.ingrediente_id,Nombre:i.Nombre,cantidad:"",unidad:""}),e.value="")}}eliminarIngrediente(t){this.ingredientesSeleccionados.splice(t,1)}validarFormulario(t){this.formErrors={};let e=!0;return t.value.nombre&&t.value.nombre.length>this.NOMBRE_MAX_LENGTH&&(this.formErrors.nombre=`El nombre no puede exceder los ${this.NOMBRE_MAX_LENGTH} caracteres.`,e=!1),t.value.imagen&&t.value.imagen.length>this.IMAGEN_MAX_LENGTH&&(this.formErrors.imagen=`La URL de imagen no puede exceder los ${this.IMAGEN_MAX_LENGTH} caracteres.`,e=!1),t.value.descripcion&&t.value.descripcion.length>this.DESCRIPCION_MAX_LENGTH&&(this.formErrors.descripcion=`La descripci\xF3n no puede exceder los ${this.DESCRIPCION_MAX_LENGTH} caracteres.`,e=!1),this.origen&&this.origen.length>this.ORIGEN_MAX_LENGTH&&(this.formErrors.origen=`El origen no puede exceder los ${this.ORIGEN_MAX_LENGTH} caracteres.`,e=!1),this.videoLink&&this.videoLink.length>this.VIDEO_MAX_LENGTH&&(this.formErrors.videoLink=`El enlace del v\xEDdeo no puede exceder los ${this.VIDEO_MAX_LENGTH} caracteres.`,e=!1),!this.esCreacionPropia&&this.autorOriginal&&this.autorOriginal.length>this.AUTOR_MAX_LENGTH&&(this.formErrors.autorOriginal=`El nombre del autor no puede exceder los ${this.AUTOR_MAX_LENGTH} caracteres.`,e=!1),t.value.tiempo_preparacion&&t.value.tiempo_preparacion<0&&(this.formErrors.tiempo_preparacion="El tiempo de preparaci\xF3n debe ser un n\xFAmero positivo.",e=!1),t.value.tiempo_coccion&&t.value.tiempo_coccion<0&&(this.formErrors.tiempo_coccion="El tiempo de cocci\xF3n debe ser un n\xFAmero positivo.",e=!1),t.value.tiempo_total&&t.value.tiempo_total<0&&(this.formErrors.tiempo_total="El tiempo total debe ser un n\xFAmero positivo.",e=!1),t.value.porciones&&t.value.porciones<0&&(this.formErrors.porciones="El n\xFAmero de porciones debe ser un n\xFAmero positivo.",e=!1),t.value.calorias_totales&&t.value.calorias_totales<0&&(this.formErrors.calorias_totales="Las calor\xEDas totales deben ser un n\xFAmero positivo.",e=!1),this.ingredientesSeleccionados.length===0?(this.formErrors.ingredientes="Debes seleccionar al menos un ingrediente.",e=!1):this.ingredientesSeleccionados.findIndex(i=>!i.cantidad||!i.unidad)>=0&&(this.formErrors.ingredientes="Todos los ingredientes deben tener cantidad y unidad.",e=!1),e}onSubmit(t){if(t.valid&&this.validarFormulario(t)){let e={receta_id:this.recetaId,nombre:this.nombre,imagen:this.imagen,descripcion:this.descripcion,tiempo_preparacion:this.tiempo_preparacion,tiempo_coccion:this.tiempo_coccion,tiempo_total:this.tiempo_total,categoria:this.categoria,porciones:this.porciones,calorias_totales:this.calorias_totales,dificultad:this.dificultad,video_instrucciones:this.videoLink,publica:this.esPublica,es_creacion_propia:this.esCreacionPropia,autor:this.esCreacionPropia?null:this.autorOriginal,origen:this.origen,fecha_creacion:this.fechaCreacion,ingredientes:this.ingredientesSeleccionados.map(d=>({ingrediente_id:d.ingrediente_id,cantidad:d.cantidad,unidad:d.unidad}))};console.log("Datos a enviar:",e),this.recetasService.actualizarReceta(this.recetaId,e).subscribe({next:d=>{console.log("Respuesta del servidor:",d),this.router.navigate(["/recetas/detalle",this.recetaId])},error:d=>{console.error("Error al actualizar la receta:",d),this.formErrors.general="Error al guardar los cambios. Por favor, int\xE9ntalo de nuevo."}})}else console.error("El formulario no es v\xE1lido"),Object.keys(t.controls).forEach(e=>{t.controls[e].markAsTouched()})}cancelar(){this.router.navigate(["/recetas/detalle",this.recetaId])}updateImagePreview(t){if(!t||t.trim()===""){this.imagePreview=null,this.imageError=!1;return}if(![".jpg",".jpeg",".png",".gif",".webp",".svg"].some(a=>t.toLowerCase().includes(a))&&!t.includes("http")){this.imagePreview=null,this.imageError=!1;return}let i=new Image;i.onload=()=>{this.imagePreview=t,this.imageError=!1},i.onerror=()=>{this.imagePreview=null,this.imageError=!0},i.src=t}updateVideoPreview(t){let e=t.target.value;if(!e||e.trim()===""){this.videoPreview=null,this.videoError=!1;return}let d=this.convertToEmbedUrl(e);d?(this.videoPreview=this.sanitizer.bypassSecurityTrustResourceUrl(d),this.videoError=!1):(this.videoPreview=null,this.videoError=!0)}convertToEmbedUrl(t){let e=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,d=t.match(e);return d?`https://www.youtube.com/embed/${d[1]}`:t.includes("youtube.com/embed/")||t.includes("youtu.be/embed/")?t:null}static \u0275fac=function(e){return new(e||r)(h(A),h(W),h($),h(ee),h(ie),h(k),h(N))};static \u0275cmp=I({type:r,selectors:[["app-modificar-recetas"]],decls:4,vars:3,consts:[["form","ngForm"],[1,"modificar-receta-container"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],[1,"loading"],[1,"error-message"],[1,"back-button",3,"click"],[3,"ngSubmit"],["for","nombre"],["type","text","id","nombre","name","nombre","required","","maxlength","255",3,"ngModelChange","ngModel"],["for","imagen"],["type","url","id","imagen","name","imagen","required","","maxlength","2048",1,"form-control",2,"width","100%","padding","8px","border","1px solid #ccc","border-radius","4px",3,"ngModelChange","input","ngModel"],["class","image-preview-container",4,"ngIf"],["for","videoLink"],["type","text","id","videoLink","name","videoLink","maxlength","255",3,"ngModelChange","input","ngModel"],["class","video-preview-container",4,"ngIf"],["for","descripcion"],["id","descripcion","name","descripcion","required","","maxlength","255",3,"ngModelChange","ngModel"],["for","origen"],["type","text","id","origen","name","origen","placeholder","Pa\xEDs o regi\xF3n de origen","maxlength","255",3,"ngModelChange","ngModel"],["for","fechaCreacion"],["type","date","id","fechaCreacion","name","fechaCreacion",3,"ngModelChange","ngModel"],["for","esPublica"],["type","checkbox","id","esPublica","name","esPublica",3,"ngModelChange","ngModel"],[3,"ngClass"],["for","esCreacionPropia"],["type","checkbox","id","esCreacionPropia","name","esCreacionPropia",3,"ngModelChange","ngModel"],["for","tiempo_preparacion"],["type","number","id","tiempo_preparacion","name","tiempo_preparacion","required","","min","0",3,"ngModelChange","ngModel"],["for","tiempo_coccion"],["type","number","id","tiempo_coccion","name","tiempo_coccion","min","0",3,"ngModelChange","ngModel"],["for","tiempo_total"],["type","number","id","tiempo_total","name","tiempo_total","min","0",3,"ngModelChange","ngModel"],["for","categoria"],["id","categoria","name","categoria",3,"ngModelChange","ngModel"],["value","Postre"],["value","Plato principal"],["value","Entrada"],["value","Bebida"],["for","porciones"],["type","number","id","porciones","name","porciones","min","0",3,"ngModelChange","ngModel"],["for","calorias_totales"],["type","number","id","calorias_totales","name","calorias_totales","min","0",3,"ngModelChange","ngModel"],["for","dificultad"],["id","dificultad","name","dificultad","required","",3,"ngModelChange","ngModel"],["value","F\xE1cil"],["value","Media"],["value","Dif\xEDcil"],["for","ingredientes"],["id","ingredientes",3,"change"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["class","error-message general-error",4,"ngIf"],[1,"form-actions"],["type","submit",1,"save-button"],["type","button",1,"cancel-button",3,"click"],[1,"image-preview-container"],["class","image-preview",4,"ngIf"],["class","image-error",4,"ngIf"],[1,"image-preview"],["alt","Vista previa de la imagen",1,"avatar-preview",2,"max-width","300px","max-height","200px","object-fit","contain",3,"src"],[1,"preview-label"],[1,"image-error"],[1,"error-icon"],[1,"error-text"],[1,"video-preview-container"],["class","video-preview",4,"ngIf"],["class","video-error",4,"ngIf"],[1,"video-preview"],["frameborder","0","allowfullscreen","",1,"recipe-video-preview",3,"src"],[1,"video-error"],["for","autorOriginal"],["type","text","id","autorOriginal","name","autorOriginal","maxlength","255",3,"ngModelChange","ngModel"],[3,"value"],[4,"ngFor","ngForOf"],["type","number","placeholder","Cantidad","min","0",3,"ngModelChange","ngModel","name"],[3,"ngModelChange","ngModel","name"],[3,"label",4,"ngFor","ngForOf"],["type","button",3,"click"],[3,"label"],[1,"error-message","general-error"]],template:function(e,d){e&1&&(o(0,"div",1),_(1,oe,3,0,"div",2)(2,re,5,1,"div",3)(3,Te,111,42,"div",4),n()),e&2&&(c(),p("ngIf",d.cargando),c(),p("ngIf",d.error),c(),p("ngIf",!d.cargando&&!d.error&&d.esPropietario))},dependencies:[L,O,T,V,Z,j,q,K,F,U,D,X,G,z,J,Q,Y,H,B],styles:[".modificar-receta-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px}h2[_ngcontent-%COMP%]{color:#333;border-bottom:2px solid #4CAF50;padding-bottom:10px;margin-bottom:20px}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block}input[type=text][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%], input[type=date][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box;font-size:16px}textarea[_ngcontent-%COMP%]{min-height:100px;resize:vertical}input[type=checkbox][_ngcontent-%COMP%]{margin-right:8px;transform:scale(1.2)}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px;padding:10px;background-color:#f9f9f9;border-radius:4px;flex-wrap:wrap}li[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], li[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;min-width:80px}li[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#f44336;color:#fff;border:none;padding:5px 10px;border-radius:4px;cursor:pointer}li[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.error-message[_ngcontent-%COMP%]{color:#f44336;font-size:.9em;margin-top:5px}.back-button[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin-top:10px}.back-button[_ngcontent-%COMP%]:hover{background-color:#0b7dda}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px;font-size:18px;color:#666}.texto-verde[_ngcontent-%COMP%]{color:#4caf50;font-weight:700;margin-left:5px}.texto-rojo[_ngcontent-%COMP%]{color:#f44336;font-weight:700;margin-left:5px}",".error-message[_ngcontent-%COMP%]{color:red;font-size:.8em;margin-top:5px}.general-error[_ngcontent-%COMP%]{font-size:1em;margin:15px 0}.form-actions[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px}.save-button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer}.cancel-button[_ngcontent-%COMP%]{background-color:#f44336;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer}.save-button[_ngcontent-%COMP%]:hover{background-color:#45a049}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.texto-verde[_ngcontent-%COMP%]{color:green}.texto-rojo[_ngcontent-%COMP%]{color:red}.loading[_ngcontent-%COMP%]{text-align:center;padding:20px}.image-preview-container[_ngcontent-%COMP%]{margin-top:10px}.image-preview[_ngcontent-%COMP%]{position:relative;display:inline-block}.recipe-image-preview[_ngcontent-%COMP%]{max-width:100%;height:auto;border-radius:4px}.preview-label[_ngcontent-%COMP%]{text-align:center;margin-top:5px;font-size:.9em}.image-error[_ngcontent-%COMP%]{color:red;text-align:center;margin-top:5px}.video-preview-container[_ngcontent-%COMP%]{margin-top:10px}.video-preview[_ngcontent-%COMP%]{position:relative;display:inline-block;width:100%;padding-top:56.25%}.recipe-video-preview[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:4px}.video-error[_ngcontent-%COMP%]{color:red;text-align:center;margin-top:5px}.error-icon[_ngcontent-%COMP%]{font-size:1.2em;margin-right:5px}"]})};export{ne as ModificarRecetasComponent};
