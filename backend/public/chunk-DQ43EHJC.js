import{a as $}from"./chunk-YECV26LB.js";import{$a as h,Ca as s,F as v,Fa as g,Fb as k,I as F,Ia as l,Ja as d,Ka as u,Kb as I,L as m,Ob as y,Pa as x,Qa as p,bb as _,f as O,la as a,pa as M,ta as P,ya as S}from"./chunk-KV2FSBEJ.js";var b=class r{constructor(o,t){this.http=o;this.cookieService=t;this.cargarFavoritosIniciales()}baseUrl="http://localhost:3000/api/favoritos";favoritosSubject=new O(new Set);favoritos$=this.favoritosSubject.asObservable();getHeaders(){let o=this.cookieService.get("jwt");if(!o)throw console.error("Error: El token no est\xE1 definido. Por favor, inicie sesi\xF3n."),new Error("El token no est\xE1 definido.");return console.log("Token encontrado para favoritos:",o.substring(0,20)+"..."),{Authorization:`Bearer ${o}`}}cargarFavoritosIniciales(){try{if(!this.cookieService.get("jwt")){console.log("No hay token disponible, saltando carga de favoritos iniciales");return}this.obtenerFavoritos(1,1e3).subscribe({next:t=>{console.log("Respuesta de favoritos:",t);let e=new Set(t.data.favoritos.map(n=>n.receta_id));this.favoritosSubject.next(e)},error:t=>{console.error("Error al cargar favoritos iniciales:",t),console.error("Detalles del error:",t.error),console.error("Status:",t.status),console.error("Status Text:",t.statusText)}})}catch(o){console.error("Error en cargarFavoritosIniciales:",o)}}obtenerFavoritos(o=1,t=10,e,n,c,C,E){try{let f=this.getHeaders(),i=`${this.baseUrl}?page=${o}&limit=${t}`;return e==="ingrediente"?i+=`&filterCriteria=ingrediente&searchQuery=&ingredientes=${E??""}`:e==="fecha_creacion"||e==="fecha_publicacion"?(i+=`&filterCriteria=${encodeURIComponent(e??"")}`,i+="&searchQuery=",c&&(i+=`&fechaDesde=${encodeURIComponent(c)}`),C&&(i+=`&fechaHasta=${encodeURIComponent(C)}`)):e&&n&&n.trim()!==""&&(i+=`&filterCriteria=${encodeURIComponent(e)}`,i+=`&searchQuery=${encodeURIComponent(n.trim())}`),this.http.get(i,{headers:f,withCredentials:!0})}catch(f){throw console.error("Error en obtenerFavoritos:",f),f}}agregarFavorito(o){let t=this.getHeaders();return this.http.post(`${this.baseUrl}/${o}`,{},{headers:t,withCredentials:!0}).pipe(v(()=>{let e=this.favoritosSubject.value;e.add(o),this.favoritosSubject.next(new Set(e))}))}quitarFavorito(o){let t=this.getHeaders();return this.http.delete(`${this.baseUrl}/${o}`,{headers:t,withCredentials:!0}).pipe(v(()=>{let e=this.favoritosSubject.value;e.delete(o),this.favoritosSubject.next(new Set(e))}))}alternarFavorito(o){let t=this.getHeaders();return this.http.patch(`${this.baseUrl}/alternar/${o}`,{},{headers:t,withCredentials:!0}).pipe(v(e=>{let n=this.favoritosSubject.value;e.data.esFavorito?n.add(o):n.delete(o),this.favoritosSubject.next(new Set(n))}))}verificarFavorito(o){let t=this.getHeaders();return this.http.get(`${this.baseUrl}/verificar/${o}`,{headers:t,withCredentials:!0})}obtenerEstadisticasFavoritos(o){let t=this.getHeaders();return this.http.get(`${this.baseUrl}/estadisticas/${o}`,{headers:t,withCredentials:!0})}esFavorito(o){return this.favoritosSubject.value.has(o)}getFavoritosActuales(){return this.favoritosSubject.value}refrescarFavoritos(){this.cargarFavoritosIniciales()}static \u0275fac=function(t){return new(t||r)(m(y),m($))};static \u0275prov=F({token:r,factory:r.\u0275fac,providedIn:"root"})};function B(r,o){r&1&&u(0,"i",5)}function T(r,o){if(r&1&&(l(0,"span",6),h(1),d()),r&2){let t=p();a(),_(" ",t.textoBoton," ")}}function U(r,o){if(r&1&&(l(0,"span",7),h(1),d()),r&2){let t=p();a(),_(" ",t.totalFavoritos," ")}}var w=class r{constructor(o){this.favoritosService=o}recetaId;mostrarTexto=!1;tama\u00F1o="medium";variante="outlined";esFavorito=!1;cargando=!1;totalFavoritos=0;favoritosSubscription;ngOnInit(){this.verificarEstadoFavorito(),this.cargarEstadisticas(),this.favoritosSubscription=this.favoritosService.favoritos$.subscribe(()=>{this.verificarEstadoFavorito()})}ngOnDestroy(){this.favoritosSubscription&&this.favoritosSubscription.unsubscribe()}verificarEstadoFavorito(){this.esFavorito=this.favoritosService.esFavorito(this.recetaId)}cargarEstadisticas(){this.favoritosService.obtenerEstadisticasFavoritos(this.recetaId).subscribe({next:o=>{o.success&&(this.totalFavoritos=o.data.totalFavoritos)},error:o=>{console.error("Error al cargar estad\xEDsticas de favoritos:",o)}})}alternarFavorito(){this.cargando||(this.cargando=!0,this.esFavorito?this.favoritosService.quitarFavorito(this.recetaId).subscribe({next:o=>{o.success&&(this.esFavorito=!1,this.totalFavoritos=Math.max(0,this.totalFavoritos-1)),this.cargando=!1},error:o=>{console.error("Error al quitar favorito:",o),this.cargando=!1}}):this.favoritosService.agregarFavorito(this.recetaId).subscribe({next:o=>{o.success&&(this.esFavorito=!0,this.totalFavoritos++),this.cargando=!1},error:o=>{console.error("Error al agregar favorito:",o),this.cargando=!1}}))}get iconoClase(){let o="boton-favorito",t=`boton-favorito--${this.tama\u00F1o}`,e=`boton-favorito--${this.variante}`,n=this.esFavorito?"boton-favorito--favorito":"",c=this.cargando?"boton-favorito--cargando":"";return`${o} ${t} ${e} ${n} ${c}`.trim()}get iconoCorazon(){return this.esFavorito?"fas fa-heart":"far fa-heart"}get textoBoton(){return this.cargando?"Cargando...":this.esFavorito?"Quitar de favoritos":"Agregar a favoritos"}static \u0275fac=function(t){return new(t||r)(M(b))};static \u0275cmp=P({type:r,selectors:[["app-boton-favorito"]],inputs:{recetaId:"recetaId",mostrarTexto:"mostrarTexto",tama\u00F1o:"tama\xF1o",variante:"variante"},decls:5,vars:9,consts:[["type","button",3,"click","disabled","title"],["aria-hidden","true"],["class","fas fa-spinner fa-spin boton-favorito__spinner","aria-hidden","true",4,"ngIf"],["class","boton-favorito__texto",4,"ngIf"],["class","boton-favorito__contador",4,"ngIf"],["aria-hidden","true",1,"fas","fa-spinner","fa-spin","boton-favorito__spinner"],[1,"boton-favorito__texto"],[1,"boton-favorito__contador"]],template:function(t,e){t&1&&(l(0,"button",0),x("click",function(){return e.alternarFavorito()}),u(1,"i",1),S(2,B,1,0,"i",2)(3,T,2,1,"span",3)(4,U,2,1,"span",4),d()),t&2&&(g(e.iconoClase),s("disabled",e.cargando)("title",e.textoBoton),a(),g(e.iconoCorazon),a(),s("ngIf",e.cargando),a(),s("ngIf",e.mostrarTexto),a(),s("ngIf",e.totalFavoritos>0))},dependencies:[I,k],styles:[".boton-favorito[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;border:none;background:transparent;cursor:pointer;transition:all .3s ease;border-radius:50%;padding:.5rem;position:relative;font-family:inherit}.boton-favorito[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.boton-favorito[_ngcontent-%COMP%]:active{transform:scale(.95)}.boton-favorito[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.6;transform:none!important}.boton-favorito--outlined[_ngcontent-%COMP%]{border:2px solid #e0e0e0;background:#fff;color:#666}.boton-favorito--outlined[_ngcontent-%COMP%]:hover, .boton-favorito--outlined.boton-favorito--activo[_ngcontent-%COMP%]{border-color:#ff4757;color:#ff4757;background:#ff47571a}.boton-favorito--outlined.boton-favorito--activo[_ngcontent-%COMP%]:hover{background:#ff475733}.boton-favorito--filled[_ngcontent-%COMP%]{background:#f0f0f0;color:#666}.boton-favorito--filled[_ngcontent-%COMP%]:hover, .boton-favorito--filled.boton-favorito--activo[_ngcontent-%COMP%]{background:#ff4757;color:#fff}.boton-favorito--filled.boton-favorito--activo[_ngcontent-%COMP%]:hover{background:#ff3742}.boton-favorito--small[_ngcontent-%COMP%]{padding:.25rem;font-size:.875rem}.boton-favorito--small[_ngcontent-%COMP%]   .boton-favorito__texto[_ngcontent-%COMP%]{font-size:.75rem}.boton-favorito--small[_ngcontent-%COMP%]   .boton-favorito__contador[_ngcontent-%COMP%]{font-size:.625rem;padding:.125rem .25rem}.boton-favorito--medium[_ngcontent-%COMP%]{padding:.5rem;font-size:1rem}.boton-favorito--medium[_ngcontent-%COMP%]   .boton-favorito__texto[_ngcontent-%COMP%]{font-size:.875rem}.boton-favorito--medium[_ngcontent-%COMP%]   .boton-favorito__contador[_ngcontent-%COMP%]{font-size:.75rem;padding:.25rem .375rem}.boton-favorito--large[_ngcontent-%COMP%]{padding:.75rem;font-size:1.25rem}.boton-favorito--large[_ngcontent-%COMP%]   .boton-favorito__texto[_ngcontent-%COMP%]{font-size:1rem}.boton-favorito--large[_ngcontent-%COMP%]   .boton-favorito__contador[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .5rem}.boton-favorito--cargando[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]:not(.boton-favorito__spinner){opacity:.3}.boton-favorito__spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.boton-favorito__texto[_ngcontent-%COMP%]{white-space:nowrap;font-weight:500}.boton-favorito__contador[_ngcontent-%COMP%]{background:#0000001a;border-radius:12px;font-size:.75rem;font-weight:600;line-height:1;min-width:1.5rem;text-align:center}.boton-favorito[_ngcontent-%COMP%]:has(.boton-favorito__texto){border-radius:6px;padding:.5rem 1rem}.boton-favorito[_ngcontent-%COMP%]   .fa-heart[_ngcontent-%COMP%]{transition:color .3s ease}.boton-favorito[_ngcontent-%COMP%]   .fa-heart.fas[_ngcontent-%COMP%]{color:#ff4757;animation:_ngcontent-%COMP%_heartbeat .6s ease-in-out}.boton-favorito[_ngcontent-%COMP%]   .fa-heart.far[_ngcontent-%COMP%]{color:#666}.boton-favorito--favorito[_ngcontent-%COMP%]   .fa-heart[_ngcontent-%COMP%]{color:#ff4757!important}@media (max-width: 768px){.boton-favorito--large[_ngcontent-%COMP%]{padding:.5rem;font-size:1rem}.boton-favorito--medium[_ngcontent-%COMP%]{padding:.375rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_heartbeat{0%{transform:scale(1)}50%{transform:scale(1.3)}to{transform:scale(1)}}@media (prefers-color-scheme: dark){.boton-favorito--outlined[_ngcontent-%COMP%]{border-color:#444;background:#2a2a2a;color:#ccc}.boton-favorito--outlined[_ngcontent-%COMP%]:hover, .boton-favorito--outlined.boton-favorito--activo[_ngcontent-%COMP%]{border-color:#ff4757;color:#ff4757;background:#ff475733}.boton-favorito--filled[_ngcontent-%COMP%]{background:#444;color:#ccc}.boton-favorito--filled[_ngcontent-%COMP%]:hover, .boton-favorito--filled.boton-favorito--activo[_ngcontent-%COMP%]{background:#ff4757;color:#fff}.boton-favorito__contador[_ngcontent-%COMP%]{background:#fff3;color:inherit}}"]})};export{b as a,w as b};
